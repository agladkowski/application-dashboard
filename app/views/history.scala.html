@(history: Array[config.DashboardHistory.VersionHistory], numberOfDays: Int)

@main("Dashboard - History") {
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">
                    Version history
                    <div class="historyFilter">
                        [@if(numberOfDays == 1){1 day}else{<a href="/history/1">1 day</a>}]
                        [@if(numberOfDays == 2){2 days}else{<a href="/history/2">2 days</a>}]
                        [@if(numberOfDays == 7){1 week}else{<a href="/history/7">1 week</a>}]
                        [@if(numberOfDays == 14){2 weeks}else{<a href="/history/14">2 weeks</a>}]
                        [@if(numberOfDays > 14){All}else{<a href="/history/30">all</a>}]
                    </div>
                </h1>
            </div>

            <style>
                #historyContainer {
                    box-sizing: border-box;
                    width: 100%;
                    height: 300px;
                }
                #historyContainer .vis.timeline .item.selected {
                    /*border-color: #428bca;*/
                    background-color: lightyellow;
                }
                #historyContainer .vis.timeline .item {
                    /*border-color: darkgreen;*/
                    background-color: lightgreen;
                    /*color: white;*/
                }
            </style>

            <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>
            <script src="http://visjs.org/dist/vis.js"></script>
            <link href="http://visjs.org/dist/vis.css" rel="stylesheet" type="text/css" />

            <div class="col-sm-12">
                <div id="historyContainer"></div>
            </div>

            <script>
                var groups = new vis.DataSet ( );
                var items = new vis.DataSet ( ) ;
                @history.groupBy(_.environment).toSeq.sortBy(_._1).map {
                    case (environment, versionsHistoryInEnv) => {
                        groups.add({id: '@environment', content: "@environment"});
                        @versionsHistoryInEnv.map { event =>
                            var item = {id : '@event.id', group : '@environment', content : '@event.applicationName (@event.version)', start : moment("@event.eventDate" ), type : 'box'}
                            items.add ( item ) ;
                        }
                    }
                }

                var container = document.getElementById ( 'historyContainer' ) ;
                var options = {
                    groupOrder : 'content' // groupOrder can be a property name or a sorting function
                } ;

                var timeline = new vis.Timeline ( container ) ;
                timeline.setOptions ( options ) ;
                timeline.setGroups ( groups ) ;
                timeline.setItems ( items ) ;

            </script>

        </div>
    </div>
}
